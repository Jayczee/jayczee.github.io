import{u as _,g as ee,h as se,i as z,j as ae,k as te,t as le,l as ie,m as D,n as H,p as re,w as ne,q as a,v as ue,R as F,x as oe,y as ce,z as ve,D as me,A as he,B as de,C as ye,E as pe,F as ge,G as Ee,H as fe,I as be,J as T,K as M,L as xe,M as k,N as Ae}from"./app-DRtHLJdT.js";const He=["/","/code/fedex-crawler.html","/nas/","/nas/jellyfin-encode-decode.html","/nas/qbit-category.html","/linux/docker-proxy.html","/linux/link.html","/note/mysql.html","/windows/ollama.html","/nas/basic/1-docker.html","/nas/basic/10-movie-pilot.html","/nas/basic/2-portainer.html","/nas/basic/3-ddns-go.html","/nas/basic/4-certbot.html","/nas/basic/5-nginx.html","/nas/basic/6-samba.html","/nas/basic/7-qbittorrent.html","/nas/basic/8-jellyfin.html","/nas/basic/9-v2rayn.html","/nas/optional/alist.html","/nas/optional/beszel.html","/nas/optional/gpt.html","/nas/optional/teamspeak.html","/404.html","/code/","/linux/","/note/","/windows/","/nas/basic/","/nas/optional/","/category/","/category/%E7%88%AC%E8%99%AB/","/category/fedex/","/category/python/","/category/nas/","/category/linux/","/category/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","/category/windows/","/tag/","/tag/jellyfin/","/tag/%E7%BC%96%E7%A0%81%E4%B8%8E%E8%A7%A3%E7%A0%81/","/tag/qbittorrent/","/tag/docker/","/tag/proxy/","/tag/%E7%A1%AC%E9%93%BE%E6%8E%A5/","/tag/%E8%BD%AF%E9%93%BE%E6%8E%A5/","/tag/mysql/","/tag/ollama/","/tag/movie-pilot/","/tag/portainer/","/tag/ddns-go/","/tag/certbot/","/tag/nginx/","/tag/samba/","/tag/v2ray/","/tag/v2raya/","/tag/%E4%BB%A3%E7%90%86/","/tag/alist/","/tag/beszel/","/tag/chatgpt/","/tag/openai/","/tag/teamspeak/","/article/","/star/","/timeline/"],ke="SLIMSEARCH_QUERY_HISTORY",p=_(ke,[]),we=()=>{const{queryHistoryCount:t}=k,l=t>0;return{enabled:l,queryHistories:p,addQueryHistory:i=>{l&&(p.value=Array.from(new Set([i,...p.value.slice(0,t-1)])))},removeQueryHistory:i=>{p.value=[...p.value.slice(0,i),...p.value.slice(i+1)]}}},L=t=>He[t.id]+("anchor"in t?`#${t.anchor}`:""),qe="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:U}=k,g=_(qe,[]),Re=()=>{const t=U>0;return{enabled:t,resultHistories:g,addResultHistory:l=>{if(t){const i={link:L(l),display:l.display};"header"in l&&(i.header=l.header),g.value=[i,...g.value.slice(0,U-1)]}},removeResultHistory:l=>{g.value=[...g.value.slice(0,l),...g.value.slice(l+1)]}}},Ce=t=>{const l=me(),i=z(),w=he(),n=D(0),f=H(()=>n.value>0),d=de([]);return ye(()=>{const{search:y,terminate:q}=pe(),E=xe(o=>{const{resultsFilter:b=u=>u,querySplitter:I,suggestionsFilter:R,...C}=l.value;o?(n.value+=1,y(o,i.value,C).then(u=>b(u,o,i.value,w.value)).then(u=>{n.value-=1,d.value=u}).catch(u=>{console.warn(u),n.value-=1,n.value||(d.value=[])})):d.value=[]},k.searchDelay-k.suggestDelay,{maxWait:5e3});ge([t,i],([o])=>E(o.join(" "))),Ee(()=>{q()})}),{isSearching:f,results:d}};var Se=ee({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:l}){const i=se(),w=z(),n=ae(te),{enabled:f,addQueryHistory:d,queryHistories:y,removeQueryHistory:q}=we(),{enabled:E,resultHistories:o,addResultHistory:b,removeResultHistory:I}=Re(),R=f||E,C=le(t,"queries"),{results:u,isSearching:O}=Ce(C),r=ie({isQuery:!0,index:0}),m=D(0),h=D(0),$=H(()=>R&&(y.value.length>0||o.value.length>0)),Q=H(()=>u.value.length>0),S=H(()=>u.value[m.value]||null),P=()=>{const{isQuery:e,index:s}=r;s===0?(r.isQuery=!e,r.index=e?o.value.length-1:y.value.length-1):r.index=s-1},Y=()=>{const{isQuery:e,index:s}=r;s===(e?y.value.length-1:o.value.length-1)?(r.isQuery=!e,r.index=0):r.index=s+1},G=()=>{m.value=m.value>0?m.value-1:u.value.length-1,h.value=S.value.contents.length-1},J=()=>{m.value=m.value<u.value.length-1?m.value+1:0,h.value=0},K=()=>{h.value<S.value.contents.length-1?h.value+=1:J()},N=()=>{h.value>0?h.value-=1:G()},B=e=>e.map(s=>Ae(s)?s:a(s[0],s[1])),V=e=>{if(e.type==="customField"){const s=fe[e.index]||"$content",[c,A=""]=be(s)?s[w.value].split("$content"):s.split("$content");return e.display.map(v=>a("div",B([c,...v,A])))}return e.display.map(s=>a("div",B(s)))},x=()=>{m.value=0,h.value=0,l("updateQuery",""),l("close")},W=()=>f?a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},n.value.queryHistory),y.value.map((e,s)=>a("div",{class:["slimsearch-result-item",{active:r.isQuery&&r.index===s}],onClick:()=>{l("updateQuery",e)}},[a(T,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},e),a("button",{class:"slimsearch-remove-icon",innerHTML:M,onClick:c=>{c.preventDefault(),c.stopPropagation(),q(s)}})]))])):null,X=()=>E?a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},n.value.resultHistory),o.value.map((e,s)=>a(F,{to:e.link,class:["slimsearch-result-item",{active:!r.isQuery&&r.index===s}],onClick:()=>{x()}},()=>[a(T,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[e.header?a("div",{class:"content-header"},e.header):null,a("div",e.display.map(c=>B(c)).flat())]),a("button",{class:"slimsearch-remove-icon",innerHTML:M,onClick:c=>{c.preventDefault(),c.stopPropagation(),I(s)}})]))])):null;return re("keydown",e=>{if(t.isFocusing){if(Q.value){if(e.key==="ArrowUp")N();else if(e.key==="ArrowDown")K();else if(e.key==="Enter"){const s=S.value.contents[h.value];d(t.queries.join(" ")),b(s),i.push(L(s)),x()}}else if(E){if(e.key==="ArrowUp")P();else if(e.key==="ArrowDown")Y();else if(e.key==="Enter"){const{index:s}=r;r.isQuery?(l("updateQuery",y.value[s]),e.preventDefault()):(i.push(o.value[s].link),x())}}}}),ne([m,h],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>a("div",{class:["slimsearch-result-wrapper",{empty:t.queries.length?!Q.value:!$.value}],id:"slimsearch-results"},t.queries.length?O.value?a(ue,{hint:n.value.searching}):Q.value?a("ul",{class:"slimsearch-result-list"},u.value.map(({title:e,contents:s},c)=>{const A=m.value===c;return a("li",{class:["slimsearch-result-list-item",{active:A}]},[a("div",{class:"slimsearch-result-title"},e||n.value.defaultTitle),s.map((v,Z)=>{const j=A&&h.value===Z;return a(F,{to:L(v),class:["slimsearch-result-item",{active:j,"aria-selected":j}],onClick:()=>{d(t.queries.join(" ")),b(v),x()}},()=>[v.type==="text"?null:a(v.type==="title"?oe:v.type==="heading"?ce:ve,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[v.type==="text"&&v.header?a("div",{class:"content-header"},v.header):null,a("div",V(v))])])})])})):n.value.emptyResult:R?$.value?[W(),X()]:n.value.emptyHistory:n.value.emptyResult)}});export{Se as default};
