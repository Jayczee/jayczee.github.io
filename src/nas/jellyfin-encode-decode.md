---
title: Jellyfin ç¼–ç ä¸è§£ç  | N å¡é©±åŠ¨å®‰è£…
isOriginal: true
category:
    - NAS
tag:
    - jellyfin
    - ç¼–ç ä¸è§£ç 
---

## ğŸ¥ ä»€ä¹ˆæ˜¯ç¼–ç ä¸è§£ç ï¼Ÿ

### ğŸ“¡ ç¼–ç 

ç¼–ç æ˜¯å°†åŸå§‹éŸ³è§†é¢‘æ•°æ®è½¬æ¢ä¸ºç‰¹å®šæ ¼å¼çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿äºå­˜å‚¨å’Œä¼ è¾“ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸æ¶‰åŠå‹ç¼©ï¼Œä»¥å‡å°‘æ–‡ä»¶å¤§å°ï¼Œä»è€ŒèŠ‚çœå­˜å‚¨ç©ºé—´å’Œå¸¦å®½ã€‚å¸¸è§çš„ç¼–ç æ ¼å¼åŒ…æ‹¬ï¼š

- **è§†é¢‘ç¼–ç æ ¼å¼**ï¼šå¦‚ H.264ã€H.265ï¼ˆHEVCï¼‰ã€VP9 ç­‰ã€‚
- **éŸ³é¢‘ç¼–ç æ ¼å¼**ï¼šå¦‚ AACã€MP3ã€FLAC ç­‰ã€‚

### ğŸ”„ è§£ç 

è§£ç æ˜¯å°†ç¼–ç åçš„éŸ³è§†é¢‘æ•°æ®è½¬æ¢å›å¯æ’­æ”¾æ ¼å¼çš„è¿‡ç¨‹ã€‚è§£ç å™¨è´Ÿè´£è¯»å–ç¼–ç æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå¯ä»¥åœ¨åª’ä½“æ’­æ”¾å™¨ä¸­æ’­æ”¾çš„æ ¼å¼ã€‚

## ğŸ” Jellyfin ä¸­çš„ç¼–ç ä¸è§£ç 

Jellyfin é€šè¿‡ä½¿ç”¨ FFmpeg ç­‰å·¥å…·æ¥å¤„ç†éŸ³è§†é¢‘çš„ç¼–ç ä¸è§£ç ã€‚

### 1. **è½¬ç **

å½“å®¢æˆ·ç«¯è®¾å¤‡ä¸æ”¯æŒç‰‡æºçš„éŸ³è§†é¢‘æ ¼å¼æ—¶ï¼ŒJellyfin ä¼šè‡ªåŠ¨è¿›è¡Œè½¬ç ã€‚è½¬ç æ˜¯å°†æ–‡ä»¶ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼çš„è¿‡ç¨‹ã€‚Jellyfin ä¼šæ ¹æ®å®¢æˆ·ç«¯çš„èƒ½åŠ›å’Œç½‘ç»œçŠ¶å†µé€‰æ‹©æœ€ä½³çš„è½¬ç æ–¹å¼ã€‚

### 2. **ç›´æ¥æ’­æ”¾**

å¦‚æœå®¢æˆ·ç«¯è®¾å¤‡æ”¯æŒç‰‡æºçš„éŸ³è§†é¢‘æ ¼å¼ï¼ŒJellyfin ä¼šé€‰æ‹©ç›´æ¥æ’­æ”¾ã€‚å› æ­¤ï¼Œåœ¨é€‰æ‹©ç‰‡æºæ—¶ï¼Œå°½é‡é€‰æ‹©ä¸»åŠ›æ’­æ”¾è®¾å¤‡æ”¯æŒçš„æ ¼å¼ã€‚å¦‚æœä½¿ç”¨åŠŸèƒ½è¾ƒé½å…¨çš„ç”µè§†æ’­æ”¾ï¼Œé€šå¸¸å¤§éƒ¨åˆ†éƒ½æ˜¯ç›´æ¥æ’­æ”¾çš„ã€‚

### 3. **ç¡¬è§£ä¸è½¯è§£**

- **ç¡¬è§£**ï¼šåˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿè¿›è¡Œè§£ç ï¼Œé€šå¸¸ä½¿ç”¨ NAS ä¸Šçš„æ˜¾å¡è¿›è¡Œè§£ç ï¼Œä¾‹å¦‚ NVIDIA GPU å’Œ Intel Quick Syncï¼ˆæ ¸æ˜¾ï¼‰ã€‚
  
- **è½¯è§£**ï¼šé€šè¿‡è½¯ä»¶è¿›è¡Œè§£ç ï¼Œé€šå¸¸ä¼šæ¶ˆè€—æ›´å¤šçš„ CPU èµ„æºï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå°¤å…¶æ˜¯åœ¨é«˜åˆ†è¾¨ç‡è§†é¢‘æ’­æ”¾æ—¶ã€‚é¢å¯¹é«˜è´¨é‡ç‰‡æºæ—¶ï¼Œè½¯è§£çš„æ•ˆç‡è¾ƒä½ã€‚

## ğŸ–¥ï¸ Docker ä¸­çš„ Jellyfin ä½¿ç”¨ NVIDIA æ˜¾å¡è¿›è¡Œç¡¬è§£

### 1. å®‰è£… N å¡é©±åŠ¨

å¦‚æœ Jellyfin éƒ¨ç½²åœ¨ Docker ä¸­ï¼Œå¹¶ä¸” NAS æ‹¥æœ‰ä¸€å— NVIDIA æ˜¾å¡å¹¶æƒ³ç”¨è¯¥æ˜¾å¡è§£ç ï¼Œé‚£ä¹ˆåœ¨éƒ¨ç½² Jellyfin ä¹‹å‰éœ€è¦å…ˆåœ¨ NAS ä¸Šå®‰è£… NVIDIA é©±åŠ¨ã€‚

é¦–å…ˆï¼Œè¿è¡Œå‘½ä»¤æ£€æŸ¥æ˜¯å¦å·²ç»å®‰è£… N å¡é©±åŠ¨ï¼š

```bash
nvidia-smi
```

å¦‚æœè¾“å‡ºä¿¡æ¯ç±»ä¼¼ä¸‹å›¾ï¼Œä¸” Driver Version ä¸ CUDA Version ä¸ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºå·²å®‰è£…é©±åŠ¨ã€‚

![nvidia-smi è¾“å‡ºä¿¡æ¯](/assets/images/nas/jellyfin/j-5.png)

å¦‚æœæç¤ºå‘½ä»¤ä¸å­˜åœ¨ç­‰ä¿¡æ¯ï¼Œåˆ™è§†ä¸ºæœªå®‰è£…é©±åŠ¨ã€‚

è®¿é—® [NVIDIA å®˜ç½‘](https://www.nvidia.cn/drivers/lookup/)ï¼Œæ ¹æ® NAS çš„é…ç½®ä¿¡æ¯ï¼Œæœç´¢å¯¹åº”çš„é©±åŠ¨ï¼š

![æœç´¢é©±åŠ¨](/assets/images/nas/jellyfin/j-6.png)

![æœç´¢ç»“æœ](/assets/images/nas/jellyfin/j-7.png)

å³é”®å•å‡»ä¸‹è½½æŒ‰é’®ï¼Œå¤åˆ¶åœ°å€ï¼Œåœ¨ NAS å‘½ä»¤è¡Œä¸­ä½¿ç”¨ `wget` å‘½ä»¤ä¸‹è½½(wgetéœ€è¦æ·»åŠ referå’Œuser-agentï¼Œå¦åˆ™ä¸‹è½½ä¼šç¢°åˆ°403)ï¼š

```bash
wget --user-agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36" --header="Referer: https://www.nvidia.cn/" https://cn.download.nvidia.com/XFree86/Linux-x86_64/570.133.07/NVIDIA-Linux-x86_64-570.133.07.run
```

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½åˆ°å…¶ä»–æœºå™¨ä¸Šï¼Œé€šè¿‡ SFTP æˆ– SCP ç­‰æ–¹å¼ä¼ è¾“åˆ° NAS ä¸Šã€‚

ä¸‹è½½å®Œæˆåï¼Œè¿è¡Œå‘½ä»¤ï¼Œæ ¹æ®æç¤ºå®Œæˆå®‰è£…ï¼š

```bash
sh ./NVIDIA-Linux-x86_64-550.144.03.run
```

### 2. Jellyfin Docker Compose é…ç½®

ä»¥ä¸‹æ˜¯é…ç½® Jellyfin ä½¿ç”¨ NVIDIA æ˜¾å¡çš„ Docker Compose ç¤ºä¾‹ï¼š

```yaml
version: '3.8'
volumes:
  jellyfin_config:
  jellyfin_cache:
services:
  jellyfin:
    image: nyanmisaka/jellyfin:latest
    container_name: jellyfin
    hostname: jellyfin
    restart: always
    environment:
      - TZ=Asia/Shanghai
      - NVIDIA_DRIVER_CAPABILITIES=all
      - NVIDIA_VISIBLE_DEVICES=all
    network_mode: host
    volumes:
      - jellyfin_config:/config
      - jellyfin_cache:/cache
      - /mnt/data_hdd:/data_hdd # è¯¥æ˜ å°„æ˜¯å½±éŸ³æ–‡ä»¶å­˜å‚¨ä½ç½®ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
      - /mnt/nas1_smb:/nas1_smb # è¯¥æ˜ å°„æ˜¯å½±éŸ³æ–‡ä»¶å­˜å‚¨ä½ç½®ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
      - /dev:/dev
    runtime: nvidia
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: 
              - gpu
```

:::tip
å¦‚æœå®‰è£…è¿‡ç¨‹ä¸­æç¤ºï¼š
```
ERROR: Unable to find the kernel source tree for the currently running kernel. Please make sure you have installed the kernel source files for your kernel and that they are properly configured; on Red Hat Linux systems, for example, be sure you have the 'kernel-source' or 'kernel-devel' RPM installed. If you know the correct kernel source files are installed, you may specify the kernel source path with the '--kernel-source-path' command line option.
```

è¿™æ˜¯ç”±äº`å½“å‰ç³»ç»Ÿæœªå®‰è£…å†…æ ¸å¤´æ–‡ä»¶æˆ–æºä»£ç ï¼šåœ¨Linuxç³»ç»Ÿä¸­ï¼Œå†…æ ¸å¤´æ–‡ä»¶ï¼ˆlinux-headersï¼‰æˆ–æºä»£ç ï¼ˆkernel-sourceï¼‰å¹¶ä¸æ˜¯é»˜è®¤å®‰è£…çš„ã€‚å¦‚æœç³»ç»Ÿç¼ºå°‘è¿™äº›æ–‡ä»¶ï¼Œå®‰è£…ç¨‹åºå°±æ— æ³•ç¼–è¯‘å†…æ ¸æ¨¡å—ã€‚`ã€‚å…ˆé€€å‡ºå®‰è£…ç¨‹åºï¼Œè¿è¡Œ

```bash
sudo apt-get install linux-headers-$(uname -r)
```
åç»§ç»­å®‰è£…å³å¯ã€‚
ï¼šï¼šï¼š