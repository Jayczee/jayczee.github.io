---
title: 28 æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡
order: 23
category:
    - LeetCode
tag:
    - LeetCodeé¢è¯•ç»å…¸150é¢˜
    - LeetCode28
    - ç®€å•é¢˜
    - å­—ç¬¦ä¸²
    - KMP
---

## ğŸš€ ç›¸å…³é“¾æ¥

[LeetCode 28 - æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡](https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/description/?envType=study-plan-v2&envId=top-interview-150)

## ğŸ“œ æè¿°

ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² `haystack` å’Œ `needle` ï¼Œè¯·ä½ åœ¨ `haystack` å­—ç¬¦ä¸²ä¸­æ‰¾å‡º `needle` å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ `needle` ä¸æ˜¯ `haystack` çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™è¿”å› `-1`ã€‚

## ğŸ’¡ ç¤ºä¾‹

### ç¤ºä¾‹ 1

- **è¾“å…¥**: `haystack = "sadbutsad", needle = "sad"`
- **è¾“å‡º**: `0`
- **è§£é‡Š**: `"sad"` åœ¨ä¸‹æ ‡ `0` å’Œ `6` å¤„åŒ¹é…ã€‚ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡æ˜¯ `0`ï¼Œæ‰€ä»¥è¿”å› `0`ã€‚

### ç¤ºä¾‹ 2

- **è¾“å…¥**: `haystack = "leetcode", needle = "leeto"`
- **è¾“å‡º**: `-1`
- **è§£é‡Š**: `"leeto"` æ²¡æœ‰åœ¨ `"leetcode"` ä¸­å‡ºç°ï¼Œæ‰€ä»¥è¿”å› `-1`ã€‚

## ğŸ“ æç¤º

- `1 <= haystack.length, needle.length <= 10^4`
- `haystack` å’Œ `needle` ä»…ç”±å°å†™è‹±æ–‡å­—ç¬¦ç»„æˆ

## ğŸ’­ æ€è·¯

### 1. KMPç®—æ³•

KMPç®—æ³•æ˜¯ä¸€ç§ç”¨äºå­—ç¬¦ä¸²åŒ¹é…çš„ç»å…¸ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ„å»ºéƒ¨åˆ†çš„åŒ¹é…è¡¨ï¼ˆnextæ•°ç»„ï¼‰ï¼Œåœ¨åŒ¹é…å¤±è´¥æ—¶èƒ½å¤Ÿè·³è¿‡ä¸€éƒ¨åˆ†å­—ç¬¦ï¼Œä»è€Œæé«˜åŒ¹é…æ•ˆç‡ã€‚å…·ä½“æ€è·¯å¦‚ä¸‹ï¼š

1. **æ„å»ºnextæ•°ç»„**ï¼šè®¡ç®—æ¨¡å¼ä¸²ï¼ˆneedleï¼‰çš„nextæ•°ç»„ï¼Œnextæ•°ç»„çš„æ¯ä¸ªå…ƒç´ è¡¨ç¤ºåœ¨å½“å‰å­—ç¬¦åŒ¹é…å¤±è´¥æ—¶ï¼Œæ¨¡å¼ä¸²ä¸­ä¸‹ä¸€ä¸ªå­—ç¬¦çš„ä½ç½®ã€‚
2. **ä½¿ç”¨nextæ•°ç»„è¿›è¡ŒåŒ¹é…**ï¼šåœ¨åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå½“å‰å­—ç¬¦åŒ¹é…å¤±è´¥ï¼Œåˆ™æ ¹æ®nextæ•°ç»„çš„å€¼ç§»åŠ¨æ¨¡å¼ä¸²çš„ä½ç½®ï¼Œè€Œä¸æ˜¯ç›´æ¥ç§»åŠ¨ä¸»ä¸²çš„ä½ç½®ã€‚

### 2. Sundayç®—æ³•

Sundayç®—æ³•æ˜¯ä¸€ç§æ›´é«˜æ•ˆçš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å¯¹æ¨¡å¼ä¸²å’Œä¸»ä¸²çš„å­—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶æ ¹æ®æœ€åä¸€æ¬¡åŒ¹é…å¤±è´¥çš„ä½ç½®æ¥å†³å®šä¸‹ä¸€æ­¥çš„ç§»åŠ¨è·ç¦»ã€‚å…·ä½“æ€è·¯å¦‚ä¸‹ï¼š

1. **é¢„å¤„ç†åç§»è¡¨**ï¼šè®¡ç®—æ¨¡å¼ä¸²ä¸­æ¯ä¸ªå­—ç¬¦åœ¨æ¨¡å¼ä¸²ä¸­çš„ä½ç½®ï¼Œå¹¶ä¸ºæ¯ä¸ªå­—ç¬¦ç”Ÿæˆä¸€ä¸ªåç§»é‡ã€‚
2. **åŒ¹é…è¿‡ç¨‹ä¸­ä½¿ç”¨åç§»è¡¨**ï¼šåœ¨åŒ¹é…å¤±è´¥æ—¶ï¼Œæ ¹æ®ä¸»ä¸²ä¸­ä¸‹ä¸€ä¸ªå­—ç¬¦çš„ä½ç½®æ¥å†³å®šæ¨¡å¼ä¸²çš„ç§»åŠ¨è·ç¦»ã€‚

## ğŸ’» ä»£ç å®ç°

### KMPç®—æ³•

```java
public int strStr(String haystack, String needle) {
    int[] next = buildNextArr(needle);

    int i = 0, j = 0;

    while (i < haystack.length() && j < needle.length()) {
        if (haystack.charAt(i) == needle.charAt(j)) {
            i++;
            j++;
        } else if (j == 0) {
            i++;
        } else {
            j = next[j - 1];
        }
    }

    if (j == needle.length()) {
        return i - j;
    } else {
        return -1;
    }
}

private int[] buildNextArr(String pattern) {
    int len = pattern.length();
    int[] next = new int[len];
    next[0] = 0;
    for (int i = 1, j = 0; i < len; i++) {
        while (j > 0 && pattern.charAt(i) != pattern.charAt(j)) {
            j = next[j - 1];
        }
        if (pattern.charAt(i) == pattern.charAt(j)) {
            j++;
        }
        next[i] = j;
    }
    return next;
}
```

### Sundayç®—æ³•

```java
public int strStr(String haystack, String needle) {
    int scanIndex = 0, hayStackIndex = 0, needleIndex = 0, hayLen = haystack.length(), needleLen = needle.length();
    Map<Character, Integer> offsetMap = new HashMap<>();
    for (int i = 0; i < needleLen; i++) {
        offsetMap.put(needle.charAt(i), needle.length() - i);
    }
    while (scanIndex + needleLen <= hayLen) {
        hayStackIndex = scanIndex;
        needleIndex = 0;
        // å­—ç¬¦åŒ¹é…æ—¶ï¼Œä¸¤ä¸ªæŒ‡é’ˆæŒç»­å‘åç§»åŠ¨
        while (hayStackIndex < hayLen && needleIndex < needleLen && haystack.charAt(hayStackIndex) == needle.charAt(needleIndex)) {
            hayStackIndex++;
            needleIndex++;
        }
        // è·³å‡ºå¾ªç¯æ—¶ï¼Œæ£€æŸ¥æƒ…å†µ
        if (needleIndex == needleLen) { //è‹¥æ¨¡å¼ä¸²æ‰«æå®Œäº†ï¼Œè¯´æ˜å…¨åŒ¹é…ï¼Œè¿”å›èµ·å§‹index
            return scanIndex;
        } else { //å¦åˆ™è¿›è¡Œåç§»
            if (scanIndex + needleLen >= hayLen) { //è¶…å‡ºè¾¹ç•Œ
                return -1;
            }
            boolean flag = false;
            char nextChar = haystack.charAt(scanIndex + needleLen);
            for (int i = 0; i < needleLen; i++) { //è‹¥ä¸‹ä¸€ä¸ªå­—ç¬¦å­˜åœ¨äºæ¨¡å¼ä¸²ä¸­
                if (needle.charAt(i) == nextChar) {
                    scanIndex += offsetMap.get(nextChar);
                    flag = true;
                    break;
                }
            }
            //å¦åˆ™åç§»é‡ä¸ºneedleLen + 1
            if (!flag) {
                scanIndex += needleLen;
            }
        }
    }
    return -1;
}
```